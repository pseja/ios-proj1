#!/bin/sh

export POSIXLY_CORRECT=yes
export LC_NUMERIC=en_US.UTF-8

print_help() {
    echo "Usage: xtf [-h|--help] [FILTER] [COMMAND] USER LOG [LOG2 [...]"
    echo "-h|--help - shows help"
    echo "FILTERS: "
    echo "    -a DATETIME"
    echo "    -b DATETIME"
    echo "    -c CURRENCY"
    echo "COMMANDS: "
    echo "    list"
    echo "    list-currency"
    echo "    status"
    echo "    profit"
}

# getopts nepouzivat protoze kdyz neuvidi prvni validni argument tak se ukonci
#        ale vstupy muzou byt v libovolnym poradi

#READ_INPUT_LOGS="gzip -d -c $GZIP | cat $LOGS - | sort"

#READ_FILTERED="eval $READ_INPUT_LOGS | awk -F ';' '(\$1 > $AFTER_TIME &&) {print \$0}' | grep "

FILTER=""
COMMAND=""
USER=""
LOGS=""
ZIPPED_LOGS=""

while [ "$#" -gt 0 ]; do
    case "$1" in
    -h | --help)
        print_help
        exit 0
        ;;

    -a | -b | -c)
        FILTER="$1 $2 $FILTER"
        shift 2
        ;;

    list | list-currency | status | profit)
        COMMAND="$1"
        shift
        ;;

    *.log | *.log.gz)
        while [ "$#" -gt 0 ]; do
            case "$1" in
            *.gz)
                ZIPPED_LOGS="$1 $ZIPPED_LOGS"
                ;;
            *)
                LOGS="$1 $LOGS"
                ;;
            esac
            shift
        done
        ;;

    *)
        USER="$1"
        shift
        ;;
    esac
done

echo "filter = $FILTER"
echo "command = $COMMAND"
echo "user = $USER"
echo "logs = $LOGS"
echo "zips = $ZIPPED_LOGS"
echo "-------------------"

for log in $LOGS; do
    if [ -f "$log" ]; then
        LOG_INPUT="${LOG_INPUT}$(cat "$log")"
    fi
done

for gz_log in $ZIPPED_LOGS; do
    if [ -f "$gz_log" ]; then
        LOG_INPUT="${LOG_INPUT}\n$(gzip -d -c "$gz_log")"
    fi
done
